
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Category Management</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/css/admin/category.css">
  <!-- Embedded CSS styles -->
 
</head>
<body class="bg-gray-50">
  <main class="content-main">
    <!-- Header Section -->
    <header class="mb-8">
      <h1 class="page-title">Category Management</h1>
      
      <!-- Search and Add Button Container -->
      <div class="search-container">
        <form action="/admin/category" method="get" class="search-form">
          <div class="search-input-group">
            <input 
              type="text" 
              name="search" 
              id="searchInput"
              placeholder="Search categories..." 
              class="search-input"
              value="<%= typeof search !== 'undefined' ? search : '' %>"
            >
            <button type="submit" class="search-btn">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </button>
            <% if (typeof search !== 'undefined' && search) { %>
              <button type="button" id="clearSearchBtn" class="clear-btn" title="Clear Search">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            <% } %>
          </div>
        </form>
        
        <div class="flex gap-3">
          <button id="openModalBtn" class="add-category-btn">Add Category / Offer</button>
        </div>
      </div>
    </header>

    <!-- Main Content Card -->
    <div class="main-card">
      <div class="table-section">
        <div class="table-container">
          <table class="categories-table">
            <thead>
              <tr>
                <th class="table-header">#</th>
                <th class="table-header">Name</th>
                <th class="table-header">Description</th>
                <th class="table-header">Offer</th>
                <th class="table-header">Status</th>
                <th class="table-header">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (cat && cat.length > 0) { %>
                <% cat.forEach((category, index) => { %>
                  <tr class="table-row" data-category-id="<%= category._id %>">
                    <td class="table-cell"><%= index + 1 %></td>
                    <td class="table-cell font-medium"><%= category.categoryName %></td>
                    <td class="table-cell text-gray-600"><%= category.description || '-' %></td>
                    <td class="table-cell">
                      <% if (category.categoryOffer && category.categoryOffer > 0) { %>
                        <span class="offer-badge"><%= category.categoryOffer %>%</span>
                      <% } else { %>
                        <span class="no-offer">No offer</span>
                      <% } %>
                    </td>
                    <td class="table-cell">
                      <% if (category.isListed) { %>
                        <span class="status-badge status-active">Listed</span>
                      <% } else { %>
                        <span class="status-badge status-inactive">Unlisted</span>
                      <% } %>
                    </td>
                    <td class="table-cell">
                      <div class="action-buttons">
                        <% if (category.categoryOffer && category.categoryOffer > 0) { %>
                          <button 
                            class="action-btn btn-remove-offer" 
                            onclick="removeOffer('<%= category._id %>')"
                            title="Remove Offer"
                          >
                            Remove Offer  
                          </button>
                        <% } %>
                        <% if (category.isListed) { %>
                          <button 
                            class="action-btn btn-unlist"
                            data-category-id="<%= category._id %>"
                            onclick="toggleList('<%= category._id %>',true)"
                            title="Unlist Category"
                          >
                            Unlist
                        </button>
                        <% } else { %>
                          <button 
                            class="action-btn btn-list"
                            data-category-id="<%= category._id %>"
                            onclick="toggleList('<%= category._id %>',false)"
                            title="List Category"
                          >
                            List
                        </button>
                        <% } %>
                        <button
                          onclick="editCategory('<%= category._id %>')" 
                          data-category-id="<%= category._id %>"
                          class="action-btn btn-edit"
                          title="Edit Category"
                        >
                          Edit
                      </button>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="6" class="table-cell text-center text-gray-500 py-8">
                    No categories found
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="w-full flex justify-center mt-6">
      <div class="flex space-x-2">
        <% if (currentPage > 1) { %>
          <a href="?page=<%= currentPage - 1 %>" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400 text-sm">
            &laquo; Prev
          </a>
        <% } %>

        <% for (let i = 1; i <= totalPages; i++) { %>
          <% if (i === currentPage) { %>
            <span class="px-3 py-1 bg-green-600 text-white rounded text-sm font-semibold"><%= i %></span>
          <% } else { %>
            <a href="?page=<%= i %>" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400 text-sm"><%= i %></a>
          <% } %>
        <% } %>

        <% if (currentPage < totalPages) { %>
          <a href="?page=<%= currentPage + 1 %>" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400 text-sm">
            Next &raquo;
          </a>
        <% } %>
      </div>
    </div>
  </main>

    <!-- SINGLE MODAL WITH TABS (Category + Offer) -->
    <div id="categoryModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Add New Category</h2>
          <button id="closeModalBtn" class="modal-close">&times;</button>
        </div>

        <!-- Tabs -->
        <div class="modal-tabs">
          <div id="tabCategory" class="modal-tab active">Add Category</div>
          <div id="tabOffer" class="modal-tab">Add Offer</div>
        </div>

        <div class="modal-body">
          <!-- Category Form -->
          <form id="categoryForm" class="category-form">
            <div class="form-group">
              <label for="categoryName" class="form-label">Category Name</label>
              <input 
                type="text" 
                id="categoryName" 
                name="categoryName" 
                class="form-input" 
                placeholder="Enter category name"
              >
              <div id="categoryName-error" class="error-message"></div>
            </div>
  
            <div class="form-group">
              <label for="categoryDescription" class="form-label">Description</label>
              <textarea 
                id="categoryDescription" 
                name="description" 
                class="form-textarea" 
                placeholder="Enter category description"
                rows="4"
              ></textarea>
              <div id="description-error" class="error-message"></div>
            </div>
  
            <% if (typeof csrfToken !== 'undefined') { %>
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <% } %>
  
            <button type="submit" class="submit-btn">
              <span class="btn-text">Create Category</span>
              <div class="btn-loader hidden">
                <div class="spinner"></div>
              </div>
            </button>
          </form>

          <!-- Offer Form -->
          <form id="offerForm" class="category-form hidden">
            <div class="form-group">
              <label class="form-label">Select Category</label>
              <select id="offerCategory" name="categoryId" class="form-input">
                <option value="">-- Choose Category --</option>
                <% cat.forEach(c => { %>
                  <option value="<%= c._id %>"><%= c.categoryName %></option>
                <% }) %>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Offer Percentage (%)</label>
              <input type="number" id="offerPercent" name="offerPercent" min="1" max="99" class="form-input" placeholder="e.g. 15" >
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="form-group">
                <label class="form-label">Start Date</label>
                <input type="date" id="offerStart" name="startDate" class="form-input">
              </div>
              <div class="form-group">
                <label class="form-label">End Date</label>
                <input type="date" id="offerEnd" name="endDate" class="form-input">
              </div>
            </div>

            <button type="submit" class="submit-btn">
              <span class="btn-text">Apply Offer</span>
              <div class="btn-loader hidden"><div class="spinner"></div></div>
            </button>
          </form>
        </div>
      </div>
    </div>
  
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script defer src="/js/admin/category.js"></script>
  </body>
</html>