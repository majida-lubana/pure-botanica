<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel=stylesheet href="/css/admin/order.css">
</head>

<body class="bg-gray-50">
    <main class="content-main">
        <!-- Header Section -->
        <header class="mb-8">
            <h1 class="page-title">Order Management</h1>
            <!-- Search Container -->
            <div class="search-container">
                <form action="/admin/orders" method="get" class="search-form">
                    <div class="search-input-group">
                        <input 
                            type="text" 
                            name="search" 
                            id="searchInput"
                            placeholder="Search orders..." 
                            class="search-input"
                            value="<%= typeof search !== 'undefined' ? search : '' %>"
                        >
                        <button type="submit" class="search-btn">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </button>
                        <% if (typeof search !== 'undefined' && search) { %>
                            <button type="button" id="clearSearchBtn" class="clear-btn" title="Clear Search">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        <% } %>
                    </div>
                </form>
            </div>
        </header>

        <!-- Main Content Card -->
        <div class="main-card">
            <div class="table-section">
                <div class="table-container">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th class="table-header">PRODUCT</th>
                                <th class="table-header">ORDER ID</th>
                                <th class="table-header">CUSTOMER</th>
                                <th class="table-header">STATUS</th>
                                <th class="table-header">PRICE</th>
                                <th class="table-header">DATE</th>
                                <th class="table-header">ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody>
  <% if (orders && orders.length > 0) { %>
    <% orders.forEach(order => { %>
      <tr class="table-row" data-order-id="<%= order._id %>">
        <td class="table-cell">
          <% if (order.orderItems && order.orderItems.length > 0) { %>
            <% if (order.orderItems.length <= 2) { %>
              <% order.orderItems.forEach(item => { %>
                <div class="product-item">
                  <img
            src="<%= item.displayImage || 'https://via.placeholder.com/80?text=No+Image' %>"
            alt="<%= item.displayName %>"
            class="product-thumbnail"
            onerror="this.onerror=null; this.src='https://via.placeholder.com/80?text=No+Image';"
          >
                </div>
              <% }) %>
            <% } else { %>
              <div class="product-item">
                <img
          src="<%= order.orderItems[0].displayImage || 'https://via.placeholder.com/80?text=No+Image' %>"
          alt="<%= order.orderItems[0].displayName %>"
          class="product-thumbnail"
          onerror="this.onerror=null; this.src='https://via.placeholder.com/80?text=No+Image';"
        >
                <span class="text-xs text-gray-500">+<%= order.orderItems.length - 1 %></span>
              </div>
            <% } %>
          <% } else { %>
            <span class="text-xs text-gray-500">No items</span>
          <% } %>
        </td>
        <td class="table-cell">
          <div class="product-details">
            <span class="text-sm font-semibold text-gray-900"><%= order.orderId %></span>
            <% if (order.orderItems && order.orderItems.length > 0) { %>
              <span class="text-xs text-gray-500 truncate w-full">
                <%= order.orderItems[0].displayName %>
              </span>
            <% } %>
          </div>
        </td>
        <td class="table-cell font-medium"><%= order.user ? order.user.name : 'Unknown User' %></td>
       <td class="table-cell">
  <!-- <small>Raw: <%= order.status %></small><br> -->
  <span class="status-badge status-<%= order.status.toLowerCase().replace(/ /g, '_') %>">
    <%= order.status.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ') %>
  </span>
</td>
        <td class="table-cell font-semibold">â‚¹<%= order.finalAmount.toFixed(2) %></td>
        <td class="table-cell text-gray-600"><%= new Date(order.createdOn).toLocaleDateString() %></td>
        <td class="table-cell">
          <div class="action-buttons">
            <% if (order.orderId) { %>
      <a href="order/details/<%=order.orderId%>" class="action-btn btn-view">
        <i class="fas fa-eye text-xs">View</i>
      </a>
    <% } else { %>
      <span class="text-xs text-gray-500">No Order ID</span>
    <% } %>
          </div>
        </td>
      </tr>
    <% }) %>
  <% } else { %>
    <tr>
      <td colspan="7" class="table-cell text-center text-gray-500 py-8">
        No orders found
      </td>
    </tr>
  <% } %>
</tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination">
                <% if(totalPages > 0) { %>
                    <% if(currentPage > 1) { %>
                        <a href="?page=<%= currentPage - 1 %>" class="pagination-btn">
                            <i class="fas fa-chevron-left text-xs"></i>
                        </a>
                    <% } %>
                    <% for(let i = 1; i <= totalPages; i++) { %>
                        <% if(i === currentPage) { %>
                            <span class="pagination-btn pagination-current"><%= i %></span>
                        <% } else if(i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) { %>
                            <a href="?page=<%= i %>" class="pagination-btn"><%= i %></a>
                        <% } else if(i === currentPage - 2 || i === currentPage + 2) { %>
                            <span class="pagination-btn">...</span>
                        <% } %>
                    <% } %>
                    <% if(currentPage < totalPages) { %>
                        <a href="?page=<%= currentPage + 1 %>" class="pagination-btn">
                            <i class="fas fa-chevron-right text-xs"></i>
                        </a>
                    <% } %>
                <% } %>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script defer src="/js/admin/order.js"></script>
</body>
</html>