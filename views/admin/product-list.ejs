<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Table</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome CDN -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <!-- SweetAlert2 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="/css/admin/product.css">
</head>
<body class="bg-gray-50 font-sans">
  
  <div class="ml-64 p-6">
    <div class="max-w-full">
      <!-- Header section -->
      <div class="flex flex-wrap items-center gap-4 mb-8">
        <div class="stats-card flex items-center gap-4 min-w-max">
          <div class="bg-white bg-opacity-20 rounded-full p-3">
            <i class="fas fa-shopping-cart text-white text-xl"></i>
          </div>
          <div>
            <p class="text-sm font-medium opacity-90">Total Products</p>
            <p class="text-2xl font-bold"><%= totalProducts || 0 %></p>
          </div>
          <div>
            <p class="text-sm font-medium opacity-90">Total Price</p>
            <p class="text-2xl font-bold"><%= totalPrice %></p>
          </div>
        </div>
        
        <button 
          onclick="window.location.href='/admin/add-product'" 
          class="btn-primary flex items-center gap-2"
        >
          <i class="fas fa-plus"></i>
          Add Product
        </button>
        
        <form class="relative flex-1 max-w-xs" id="searchForm">
          <div class="flex items-center gap-2">
            <div class="relative flex-1">
              <input
                class="search-input w-full pr-10"
                placeholder="Search products..."
                type="text"
                name="search"
                id="searchInput"
                value="<%= typeof search !== 'undefined' ? search : '' %>"
              />
              <button 
                aria-label="Search" 
                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors" 
                type="submit"
              >
                <i class="fas fa-search"></i>
              </button>
            </div>
            <button 
              type="button" 
              id="clearSearchBtn" 
              class="btn-clear flex items-center gap-1" 
              title="Clear Search"
              style="display: <%= (typeof search !== 'undefined' && search) ? 'flex' : 'none' %>;"
            >
              <i class="fas fa-times"></i>
              Clear
            </button>
          </div>
        </form>
      </div>
      
      <!-- Table section -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <div class="overflow-x-auto scrollbar-thin">
          <table class="min-w-full text-sm text-left">
            <thead class="table-header">
              <tr>
                <th class="px-6 py-4 font-semibold text-gray-700 uppercase tracking-wider">Image</th>
                <th class="px-6 py-4 font-semibold text-gray-700 uppercase tracking-wider">Product Name</th>
                <th class="px-6 py-4 font-semibold text-gray-700 uppercase tracking-wider">Category</th>
                <th class="px-6 py-4 font-semibold text-gray-700 uppercase tracking-wider">Price</th>
                <th class="px-6 py-4 font-semibold text-gray-700 uppercase tracking-wider">Stock</th>
                <th class="px-6 py-4 font-semibold text-gray-700 uppercase tracking-wider">Status</th>
                <th class="px-6 py-4 font-semibold text-gray-700 uppercase tracking-wider">Offer</th>
                <th class="px-6 py-4 font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              <% if (products && products.length > 0) { %>
                <% products.forEach(product => { %>
                  <tr class="table-row">
                    <td class="px-6 py-4">
                      <img
  src="<%= product.productImages && product.productImages[0] 
    ? product.productImages[0] 
    : 'https://storage.googleapis.com/a1aa/image/placeholder.jpg' %>"
  alt="<%= product.productName || 'product' %>"
  class="w-12 h-12 object-cover rounded-lg border border-gray-200"
/>



                    </td>
                    <td class="px-6 py-4">
                      <div class="font-semibold text-gray-900"><%= product.productName || 'N/A' %></div>
                    </td>
                    <td class="px-6 py-4">
                      <span class="text-gray-700"><%= product.category?.categoryName || 'N/A' %></span>
                    </td>
                    <td class="px-6 py-4">
                      <span class="font-semibold text-teal-600">â‚¹<%= product.salePrice || '0.00' %></span>
                    </td>
                    <td class="px-6 py-4">
                      <div class="text-sm text-gray-600">
                        <%= product.quantity || 'N/A' %>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <% if (!product.isBlocked) { %>
                        <span class="status-badge status-listed">Listed</span>
                      <% } else { %>
                        <span class="status-badge status-unlisted">Unlisted</span>
                      <% } %>
                    </td>
                    <td class="px-6 py-4">
                      <span class="offer-badge" data-product-id="<%= product._id %>">
                        <%= product.productOffer > 0 ? product.productOffer + '%' : 'No Offer' %>
                      </span>
                    </td>
                    <td class="px-6 py-4">
                      <div class="action-buttons">
                        <% if (product.productOffer > 0) { %>
                          <button
                            class="btn-danger"
                            data-product-id="<%= product._id %>"
                            onclick="removeOffer('<%= product._id %>')"
                            title="Remove Offer"
                          >
                            <i class="fas fa-times mr-1"></i>
                            Remove Offer
                          </button>
                        <% } else { %>
                          <button
                            class="btn-warning"
                            data-product-id="<%= product._id %>"
                            onclick="addOffer('<%= product._id %>')"
                            title="Add Offer"
                          >
                            <i class="fas fa-tag mr-1"></i>
                            Add Offer
                          </button>
                        <% } %>
                        <button
                          class="btn-secondary"
                          onclick="window.location.href='/admin/edit-product/<%= product._id %>'"
                        >
                          <i class="fas fa-edit mr-1"></i>
                          Edit
                        </button>
                        <% if (!product.isBlocked) { %>
                          <button
                            class="btn-danger"
                            data-product-id="<%= product._id %>"
                            onclick="toggleListProduct('<%= product._id %>', true)"
                            title="Unlist Product"
                          >
                            <i class="fas fa-times mr-1"></i>
                            Unlist
                          </button>
                        <% } else { %>
                          <button
                            class="btn-success"
                            data-product-id="<%= product._id %>"
                            onclick="toggleListProduct('<%= product._id %>', false)"
                            title="List Product"
                          >
                            <i class="fas fa-check mr-1"></i>
                            List
                          </button>
                        <% } %>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="8" class="px-6 py-12 text-center">
                    <div class="text-gray-500">
                      <i class="fas fa-box-open text-4xl mb-4"></i>
                      <p class="text-lg font-medium">No products found</p>
                      <p class="text-sm">Get started by adding your first product</p>
                    </div>
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="w-full flex justify-center mt-6">
    <div class="flex space-x-2">
      <% if (currentPage > 1) { %>
        <a href="?page=<%= currentPage - 1 %>" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400 text-sm">
          &laquo; Prev
        </a>
      <% } %>

      <% for (let i = 1; i <= totalPages; i++) { %>
        <% if (i === currentPage) { %>
          <span class="px-3 py-1 bg-green-600 text-white rounded text-sm font-semibold"><%= i %></span>
        <% } else { %>
          <a href="?page=<%= i %>" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400 text-sm"><%= i %></a>
        <% } %>
      <% } %>

      <% if (currentPage < totalPages) { %>
        <a href="?page=<%= currentPage + 1 %>" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400 text-sm">
          Next &raquo;
        </a>
      <% } %>
    </div>
  </div>

  <!-- Responsive adjustments -->
  <style>
    @media (max-width: 1024px) {
      .ml-64 {
        margin-left: 0;
        padding: 1rem;
      }
    }
    
    @media (max-width: 768px) {
      .ml-64 {
        margin-left: 0;
        padding: 0.5rem;
      }
      
      .flex-wrap {
        flex-direction: column;
        align-items: stretch !important;
      }
      
      .stats-card {
        width: 100%;
      }
      
      .search-input {
        margin-top: 1rem;
      }
      
      .action-buttons {
        flex-direction: row;
        flex-wrap: wrap;
      }
      
      .action-buttons button {
        flex: 1;
        min-width: 80px;
      }
      
      .px-6 {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      
      .py-4 {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
      }
    }
  </style>

<script defer src="/js/admin/product.js"></script>
</body>
</html>