<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Book</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/user/address.css">
</head>

<body>
    <%- include('../partials/user/header') %>
    <div class="account-container">
        <%- include('../partials/user/sidebar') %>
        <div class="addresses-container">
            <div class="d-flex justify-content-between align-items-center mb-4 header-container">
                <h2>Address Book</h2>
                <button class="btn btn-accent" data-bs-toggle="modal" data-bs-target="#addAddressModal">
                    <i class="fas fa-plus me-2"></i> Add New Address
                </button>
            </div>

            <div class="row g-3" id="addressesContainer">
                <% if (Array.isArray(addresses) && addresses.length > 0) { %>
                    <% addresses.forEach(function(address) { %>
                        <div class="col-lg-6 col-md-12 mb-0" data-address-id="<%= address._id %>">
                            <div class="address-card">
                                <div class="address-type <%= address.addressType === 'Home' ? 'address-type-home' : 'address-type-work' %>">
                                    <%= address.addressType %>
                                </div>
                                <div class="address-name">
                                    <%= address.fullName %>
                                    <% if (address.isDefault) { %>
                                        <span class="default-badge">Default</span>
                                    <% } %>
                                </div>
                                <div class="address-details">
                                    <%= address.address %>
                                </div>
                                <div class="address-details">
                                    <%= address.city %>, <%= address.state %>
                                    <%= address.pincode %>
                                </div>
                                <div class="address-details">
                                    <%= address.country %>
                                </div>
                                <div class="address-details">Phone: <%= address.phone %>
                                </div>
                                <div class="address-actions">
                                    <button class="btn btn-sm btn-outline-secondary edit-address"
                                            data-id="<%= address._id %>" data-bs-toggle="modal"
                                            data-bs-target="#editAddressModal">
                                        <i class="fas fa-edit me-1"></i>Edit
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger delete-address"
                                            data-id="<%= address._id %>">
                                        <i class="fas fa-trash me-1"></i>Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                <% } %>

                <div class="col-lg-6 col-md-12 mb-0">
                    <div class="add-address-card" data-bs-toggle="modal" data-bs-target="#addAddressModal">
                        <div class="add-address-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <h5>Add New Address</h5>
                        <p class="text-muted mb-0">Click to add a new shipping address</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Address Modal -->
    <div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addAddressModalLabel">Add New Address</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addAddressForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="name" class="form-label">Full Name*</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                                <div class="text-danger small" id="nameError"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Phone Number*</label>
                                <input type="tel" class="form-control" id="phone" name="phone" required>
                                <div class="text-danger small" id="phoneError"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">Address*</label>
                            <input type="text" class="form-control" id="address" name="address" required>
                            <div class="text-danger small" id="addressError"></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="city" class="form-label">City*</label>
                                <input type="text" class="form-control" id="city" name="city" required>
                                <div class="text-danger small" id="cityError"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="state" class="form-label">State/Province*</label>
                                <input type="text" class="form-control" id="state" name="state" required>
                                <div class="text-danger small" id="stateError"></div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="country" class="form-label">Country*</label>
                                <select class="form-select" id="country" name="country" required>
                                    <option value="">Select Country</option>
                                    <option value="United States">United States</option>
                                    <option value="Canada">Canada</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Australia">Australia</option>
                                    <option value="India" selected>India</option>
                                </select>
                                <div class="text-danger small" id="countryError"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="pincode" class="form-label">ZIP/Postal Code*</label>
                                <input type="text" class="form-control" id="pincode" name="pincode" required>
                                <div class="text-danger small" id="pincodeError"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label d-block">Address Type*</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="addressType" id="typeHome" value="Home" checked required>
                                <label class="form-check-label" for="typeHome">Home</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="addressType" id="typeWork" value="Work">
                                <label class="form-check-label" for="typeWork">Work</label>
                            </div>
                            <div class="text-danger small" id="addressTypeError"></div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="addIsDefault" name="isDefault">
                            <label class="form-check-label" for="addIsDefault">Set as Default Address</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-accent" id="saveAddressBtn" onclick="saveNewAddress()">Save Address</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Address Modal -->
    <div class="modal fade" id="editAddressModal" tabindex="-1" aria-labelledby="editAddressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editAddressForm">
                        <input type="hidden" id="editAddressId" name="addressId">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="editFullName" class="form-label">Full Name*</label>
                                <input type="text" class="form-control" id="editFullName" name="fullName" required>
                                <div class="text-danger small" id="editFullNameError"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="editPhone" class="form-label">Phone Number*</label>
                                <input type="tel" class="form-control" id="editPhone" name="phone" required>
                                <div class="text-danger small" id="editPhoneError"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editAddress" class="form-label">Address*</label>
                            <input type="text" class="form-control" id="editAddress" name="address" required>
                                <div class="text-danger small" id="editAddressError"></div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="editCity" class="form-label">City*</label>
                                <input type="text" class="form-control" id="editCity" name="city" required>
                                <div class="text-danger small" id="editCityError"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="editState" class="form-label">State/Province*</label>
                                <input type="text" class="form-control" id="editState" name="state" required>
                                <div class="text-danger small" id="editStateError"></div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="editCountry" class="form-label">Country*</label>
                                <select class="form-select" id="editCountry" name="country" required>
                                    <option value="">Select Country</option>
                                    <option value="United States">United States</option>
                                    <option value="Canada">Canada</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Australia">Australia</option>
                                    <option value="India">India</option>
                                </select>
                                <div class="text-danger small" id="editCountryError"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="editPincode" class="form-label">ZIP/Postal Code*</label>
                                <input type="text" class="form-control" id="editPincode" name="pincode" required>
                                <div class="text-danger small" id="editPincodeError"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label d-block">Address Type*</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="addressType" id="editTypeHome" value="Home" required>
                                <label class="form-check-label" for="editTypeHome">Home</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="addressType" id="editTypeWork" value="Work">
                                <label class="form-check-label" for="editTypeWork">Work</label>
                            </div>
                            <div class="text-danger small" id="editAddressTypeError"></div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="editIsDefault" name="isDefault">
                            <label class="form-check-label" for="editIsDefault">Set as Default Address</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-accent" id="updateAddressBtn" onclick="updateAddress()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Address Modal -->
    <div class="modal fade" id="deleteAddressModal" tabindex="-1" aria-labelledby="deleteAddressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteAddressModalLabel">Delete Address</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-trash-alt text-danger mb-3" style="font-size: 3rem;"></i>
                        <p class="mb-2">Are you sure you want to delete this address?</p>
                        <p class="text-muted small">This action cannot be undone.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteAddress">Delete Address</button>
                </div>
            </div>
        </div>
    </div>

    <%- include('../partials/user/footer') %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="/js/user/address.js"></script>
</body>

</html>