<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Referral – Pure Botanica</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/css/user/referral.css">
</head>
<body>
  <!-- Header -->
  <div class="partial">
    <%- include("../../views/partials/user/header") %>
  </div>

  <div class="container">
    <div class="grid">
      <!-- Sidebar -->
      <div class="partial">
        <%- include("../../views/partials/user/sidebar") %>
      </div>

      <!-- Main Content -->
      <div class="content">
        <div class="page-header">
          <h2 class="page-title">Invite Friends & Earn</h2>
        </div>

        <!-- Referral Card -->
        <div class="referral-card">
          <h4>Your Referral Code</h4>
          <div class="referral-code" id="refCode"><%= referral.code %></div>
          <button class="copy-btn" id="copyBtn">
            <i class="fas fa-copy"></i> Copy Code
          </button>
          <p class="mt-3 mb-0 small opacity-75">
            Share this code – your friend gets <strong>₹100 off</strong> on first order, 
            you get <strong>₹100 instantly + ₹100</strong> when they complete a purchase.
          </p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="icon"><i class="fas fa-users"></i></div>
            <div class="value"><%= referral.invitedCount %></div>
            <div class="label">Friends Invited</div>
          </div>
          <div class="stat-card">
            <div class="icon"><i class="fas fa-gift"></i></div>
            <div class="value">₹<%= referral.totalEarned %></div>
            <div class="label">Earned So Far</div>
          </div>
          <div class="stat-card">
            <div class="icon"><i class="fas fa-clock"></i></div>
            <div class="value"><%= referral.pendingCount %></div>
            <div class="label">Pending Credits</div>
          </div>
        </div>

        <!-- Instant Bonus Alert -->
        <% if (referral.invitedCount > 0) { %>
          <div class="alert alert-success d-flex align-items-center mb-4">
            <i class="fas fa-bolt me-2"></i>
            <div>
              <strong>Instant Bonus!</strong> You’ve already earned 
              <strong>₹<%= referral.invitedCount * 100 %></strong> 
              for inviting <%= referral.invitedCount %> friend<%= referral.invitedCount > 1 ? 's' : '' %>!
            </div>
          </div>
        <% } %>

        <!-- Referral History -->
        <h5 class="mt-5 mb-3">Referral History</h5>
        <% if (referral.history.length === 0) { %>
          <div class="empty-state">
            <i class="fas fa-user-friends"></i>
            <p>No referrals yet. Invite friends and watch the credits roll in!</p>
          </div>
        <% } else { %>
          <div class="table-responsive">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Friend</th>
                  <th>Date Invited</th>
                  <!-- <th>Status</th> -->
                  <th>Earned</th>
                </tr>
              </thead>
              <tbody>
                <% referral.history.forEach(h => { %>
                  <tr>
                    <td>
                      <strong><%= h.friendName || 'User' %></strong><br>
                      <small class="text-muted"><%= h.friendEmail %></small>
                    </td>
                    <td>
                      <%= new Date(h.invitedAt).toLocaleDateString('en-IN', {
                        day:'2-digit',
                        month:'short',
                        year:'numeric'
                      }) %>
                    </td>
                    <!-- <td>
                      <span class="status-badge <%= h.status === 'completed' ? 'status-completed' : 'status-pending' %>">
                        <i class="<%= h.status === 'completed' ? 'fas fa-check-circle' : 'fas fa-clock' %>"></i>
                        <%= h.status.charAt(0).toUpperCase() + h.status.slice(1) %>
                      </span>
                    </td> -->
                    <td class="fw-bold <%= h.status === 'completed' ? 'text-success' : '' %>">
                      <% if (h.status === 'completed') { %>
                        +₹100 <small class="text-success">(Order)</small>
                      <% } else { %>
                        +₹100 <span class="instant-badge">Instant</span>
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>

        <!-- Info Boxes -->
        <div class="row mt-5">
          <div class="col-md-6 mb-3">
            <div class="p-3 bg-light rounded shadow-sm">
              <h6><i class="fas fa-info-circle text-primary"></i> How It Works</h6>
              <ul class="small text-muted mb-0">
                <li>Share your code with friends</li>
                <li>They get ₹100 off on first order</li>
                <li>You get <strong>₹100 instantly</strong> + <strong>₹100 when they order</strong></li>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="p-3 bg-light rounded shadow-sm">
              <h6><i class="fas fa-gift text-success"></i> Benefits</h6>
              <ul class="small text-muted mb-0">
                <li>Unlimited referrals</li>
                <li>Instant wallet credits</li>
                <li>Use for any purchase</li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="partial">
    <%- include("../../views/partials/user/footer") %>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Copy referral code to clipboard
    document.getElementById('copyBtn').addEventListener('click', () => {
      const code = document.getElementById('refCode').innerText;
      navigator.clipboard.writeText(code).then(() => {
        const btn = document.getElementById('copyBtn');
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        btn.style.background = 'rgba(46, 204, 113, 0.3)';
        setTimeout(() => {
          btn.innerHTML = original;
          btn.style.background = 'rgba(255,255,255,.2)';
        }, 2000);
      }).catch(err => {
        alert('Failed to copy code: ' + err);
      });
    });
  </script>
</body>
</html>