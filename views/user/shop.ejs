<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Shop - Pure Botanica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
     <link rel="stylesheet" href="/css/user/shop.css">
  </head>
  <body class="bg-white text-black">
    <%- include("../partials/user/header") %>

    <main class="max-w-[1400px] mx-auto px-8 py-12 mt-8">
      <div class="relative mb-12 rounded-lg overflow-hidden shadow-lg">
        <img src="/images/bannerimages.jpeg" alt="Shop Banner" class="w-full h-[300px] object-cover" loading="lazy" />
        <div class="absolute inset-0 flex flex-col items-center justify-center bg-[#1a4a5a] bg-opacity-50 text-white">
          <h1 class="text-4xl font-bold mb-2">Shop Our Natural Products</h1>
          <p class="text-xl">Pure, Botanical Skincare for Every Skin Type</p>
        </div>
      </div>

      <nav class="max-w-[1400px] mx-auto px-8 py-4 text-sm text-gray-600">
        <ol class="flex space-x-2">
          <li><a href="/" class="hover:underline">Home</a></li>
          <li><span>></span></li>
          <li><a href="/shop" class="hover:underline">Shop</a></li>
        </ol>
      </nav>

      <div class="flex flex-col md:flex-row gap-8">
        <!-- FILTERS -->
        <aside class="w-full md:w-1/4 bg-gray-50 p-6 rounded-lg shadow-sm">
          <h2 class="text-xl font-bold mb-6 text-gray-800">Filters</h2>
          <div class="mb-4">
            <a href="/shop" class="text-white bg-[#0a2a2d] px-4 py-2 rounded hover:bg-[#0f3a3f] transition font-semibold text-sm">Clear All Filters</a>
          </div>
          <!-- Categories -->
          <div class="filter-section">
            <h3 class="font-bold mb-3 text-gray-800">Categories</h3>
            <ul class="space-y-2">
              <li class="flex items-center">
                <input type="checkbox" id="cat-all" class="mr-2" <%= selectedCategories.length === 0 ? 'checked' : '' %> />
                <label for="cat-all" class="text-gray-700">All Categories</label>
              </li>
              <% categories.forEach(cat => { %>
                <li class="flex items-center">
                  <input type="checkbox" name="category[]" value="<%= cat.categoryName %>" id="cat-<%= cat.categoryName %>"
                    <%= selectedCategories.includes(cat.categoryName) ? 'checked' : '' %> class="mr-2" />
                  <label for="cat-<%= cat.categoryName %>" class="text-gray-700">
                    <%= cat.categoryName.charAt(0).toUpperCase() + cat.categoryName.slice(1) %>
                  </label>
                </li>
              <% }) %>
            </ul>
          </div>
          <!-- Skin Type -->
          <div class="filter-section">
            <h3 class="font-bold mb-3 text-gray-800">Skin Type</h3>
            <ul class="space-y-2">
              <% skinTypeOptions.forEach(type => { %>
                <li class="flex items-center">
                  <input type="checkbox" name="skinType[]" value="<%= type %>" id="type-<%= type.toLowerCase().replace(/\s+/g, '-') %>"
                    <%= selectedSkinTypes.includes(type) ? 'checked' : '' %> class="mr-2" />
                  <label for="type-<%= type.toLowerCase().replace(/\s+/g, '-') %>" class="text-gray-700"><%= type %></label>
                </li>
              <% }) %>
            </ul>
          </div>
          <!-- Skin Concern -->
          <div class="filter-section">
            <h3 class="font-bold mb-3 text-gray-800">Skin Concern</h3>
            <ul class="space-y-2">
              <% skinConcernOptions.forEach(concern => { %>
                <li class="flex items-center">
                  <input type="checkbox" name="skinConcern[]" value="<%= concern %>" id="concern-<%= concern.toLowerCase().replace(/\s+/g, '-') %>"
                    <%= selectedSkinConcerns.includes(concern) ? 'checked' : '' %> class="mr-2" />
                  <label for="concern-<%= concern.toLowerCase().replace(/\s+/g, '-') %>" class="text-gray-700"><%= concern %></label>
                </li>
              <% }) %>
            </ul>
          </div>
          <!-- Price Range -->
          <div class="filter-section">
            <h3 class="font-bold mb-3 text-gray-800">Price Range</h3>
            <input type="number" id="minPrice" placeholder="Min Price" value="<%= minPrice || 0 %>" class="p-2 border border-gray-300 rounded w-full mb-2 text-gray-700" />
            <input type="number" id="maxPrice" placeholder="Max Price" value="<%= maxPrice || 10000 %>" class="p-2 border border-gray-300 rounded w-full mb-4 text-gray-700" />
          </div>
        </aside>

        <!-- PRODUCTS -->
        <div class="w-full md:w-3/4">
          <div class="flex flex-col sm:flex-row justify-between mb-6 gap-4">
            <div class="w-full sm:w-1/2 flex">
              <input type="text" id="searchInput" placeholder="Search products..." value="<%= search || '' %>" class="p-2 border border-gray-300 rounded w-full text-gray-700" />
              <button id="searchBtn" class="ml-2 bg-[#0a2a2d] text-white px-4 py-2 rounded hover:bg-[#0f3a3f] transition-colors font-semibold">Search</button>
            </div>
            <div class="flex items-center">
              <label for="sortSelect" class="mr-2 text-gray-700 font-semibold">Sort by:</label>
              <select id="sortSelect" class="p-2 border border-gray-300 rounded text-gray-700">
                <option value="default" <%= sort === 'default' ? 'selected' : '' %>>Newest First</option>
                <option value="price-asc" <%= sort === 'price-asc' ? 'selected' : '' %>>Price: Low to High</option>
                <option value="price-desc" <%= sort === 'price-desc' ? 'selected' : '' %>>Price: High to Low</option>
                <option value="name-asc" <%= sort === 'name-asc' ? 'selected' : '' %>>Name: A to Z</option>
                <option value="name-desc" <%= sort === 'name-desc' ? 'selected' : '' %>>Name: Z to A</option>
              </select>
            </div>
          </div>

          <!-- PRODUCTS GRID -->
          <div id="productsGrid">
            <% if (products.length > 0) { %>
              <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                <% products.forEach(product => { %>
                  <div class="product-card bg-white rounded-lg shadow-md border border-gray-200 relative">
                    <!-- Wishlist -->
                    <button class="absolute top-2 right-2 z-10 p-1.5 rounded-full hover:bg-gray-100 transition-all wishlist-btn"
                            data-product-id="<%= product._id %>" title="Add to Wishlist">
                    <i class="<%= wishlistProductIds.includes(product._id.toString()) ? 'fas text-red-500' : 'far' %> fa-heart text-lg"></i>
                    </button>

                    <div class="product-content">
                      <a href="/product/<%= product._id %>">
                        <img 
  alt="<%= product.productName %>" 
  class="mb-4 product-image w-48 h-48 mx-auto"
  src="<%= product.productImages?.[0] || 'https://via.placeholder.com/150' %>"
  loading="lazy"
/>

                      </a>
                      <div class="font-bold text-lg mb-2 text-gray-800 text-center">
                        <%= product.productName.toUpperCase() %>
                      </div>

                      <!-- Price -->
                      <div class="mb-3 text-center">
                        <div class="flex items-center justify-center gap-2 flex-wrap">
                          <span class="text-2xl font-bold text-green-600">₹<%= product.pricing.displayPrice.toFixed(2) %></span>
                          <% if (product.pricing.savings > 0) { %>
                            <span class="text-sm line-through text-gray-500">₹<%= product.pricing.originalPrice.toFixed(2) %></span>
                            <span class="offer-badge"><%= product.pricing.discountPercentage %>%</span>
                          <% } %>
                        </div>
                        <% if (product.pricing.savings > 0) { %>
                          <p class="text-xs text-gray-600 mt-1">Save ₹<%= product.pricing.savings.toFixed(2) %></p>
                        <% } %>
                        <% if (product.quantity === 0) { %>
                          <span class="text-red-600 text-sm block">(Out of Stock)</span>
                        <% } %>
                      </div>
                    </div>

                    <!-- ADD TO CART / GO TO CART -->
                    <button class="bg-[#0a2a2d] text-white text-sm font-semibold px-4 py-2 rounded hover:bg-[#0f3a3f] transition-colors w-full add-to-cart-btn"
                            data-product-id="<%= product._id %>" <%= product.quantity === 0 ? 'disabled' : '' %>>
                      <% if (product.isInCart) { %>
                        GO TO CART
                      <% } else { %>
                        <%= product.quantity === 0 ? 'OUT OF STOCK' : 'ADD TO CART' %>
                      <% } %>
                    </button>
                  </div>
                <% }) %>
              </div>
            <% } else { %>
              <div class="text-center text-gray-600 py-12">No products found. Try adjusting your filters.</div>
            <% } %>
          </div>
        </div>
      </div>
    </main>

    <!-- PAGINATION -->
    <div class="w-full flex justify-center mt-6 mb-4">
      <div class="flex space-x-2 bg-[#0a2a2d] text-white px-4 py-2 rounded">
        <% if (currentPage > 1) { %>
          <a href="?page=<%= currentPage - 1 %>" class="px-3 py-1 rounded hover:bg-[#0f3a3f] text-sm">Prev</a>
        <% } %>
        <% for (let i = 1; i <= totalPages; i++) { %>
          <% if (i === currentPage) { %>
            <span class="px-3 py-1 rounded text-sm font-semibold"><%= i %></span>
          <% } else { %>
            <a href="?page=<%= i %>" class="px-3 py-1 rounded hover:bg-[#0f3a3f] text-sm"><%= i %></a>
          <% } %>
        <% } %>
        <% if (currentPage < totalPages) { %>
          <a href="?page=<%= currentPage + 1 %>" class="px-3 py-1 rounded hover:bg-[#0f3a3f] text-sm">Next</a>
        <% } %>
      </div>
    </div>

    <%- include("../partials/user/footer") %>

   <!-- At the end of your shop.ejs, before closing </body> tag -->

<script>
  // Pass server-side data to the client-side script
  window.shopPageParams = {
    search: '<%= search || "" %>',
    sort: '<%= sort || "default" %>',
    category: <%= JSON.stringify(selectedCategories || []) %>,
    skinType: <%= JSON.stringify(selectedSkinTypes || []) %>,
    skinConcern: <%= JSON.stringify(selectedSkinConcerns || []) %>,
    minPrice: <%= minPrice || 0 %>,
    maxPrice: <%= maxPrice || 10000 %>,
    page: <%= currentPage || 1 %>
  };
</script>

<!-- Load the external script -->
<script src="/js/user/shop.js"></script>
  </body>
</html>