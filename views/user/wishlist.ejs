<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Wishlist - Pure Botanica</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/css/user/wishlist.css">
</head>
<body>
  <div class="partial">
    <%- include("../../views/partials/user/header") %>
  </div>

  <div class="container">
    <div class="grid">
      <div class="partial">
        <%- include("../../views/partials/user/sidebar") %>
      </div>

      <div class="content">
        <div class="page-header">
          <h2 class="page-title">My Wishlist (<span id="wishlist-count"><%= wishlist.length %></span>)</h2>
        </div>

        <!-- Empty State -->
        <div id="empty-wishlist" class="empty-wishlist" style="display: <%= wishlist.length === 0 ? 'block' : 'none' %>;">
          <i class="far fa-heart"></i>
          <h5>Your wishlist is empty</h5>
          <p>Browse our collection and add products you love.</p>
          <a href="/shop" class="inline-block bg-[#0a2a2d] text-white px-6 py-2 rounded hover:bg-[#0f3a3f] transition text-sm font-semibold">
            Continue Shopping
          </a>
        </div>

        <!-- Wishlist Items -->
        <div id="wishlist-container" class="wishlist-list" style="display: <%= wishlist.length > 0 ? 'flex' : 'none' %>;">
          <% wishlist.forEach(item => { %>
            <% const p = item.product; %>
            <% const pr = p.pricing; %>

            <div class="wishlist-item" data-product-id="<%= p._id %>">
              <!-- Image -->
              <div class="item-image">
                <a href="/product/<%= p._id %>">
                  <img 
  src="<%= p.images?.[0] || '/images/placeholder.jpg' %>" 
  alt="<%= p.name %>"
  onerror="this.src='/images/placeholder.jpg'">

                </a>
              </div>

              <!-- Details -->
              <div class="item-details">
                <div class="item-title">
                  <a href="/product/<%= p._id %>"><%= p.name %></a>
                </div>

                <% if (p.assured) { %>
                  <div class="assured">
                    <i class="fas fa-shield-alt"></i> Assured
                  </div>
                <% } %>

                <!-- Pricing -->
                <div class="flex items-center gap-2 flex-wrap mt-2">
                  <span class="item-price">₹<%= pr.displayPrice.toFixed(2) %></span>
                  <% if (pr.savings > 0) { %>
                    <span class="original-price">₹<%= pr.originalPrice.toFixed(2) %></span>
                    <span class="discount-badge"><%= pr.discountPercentage %>% OFF</span>
                    <span class="save-text">Save ₹<%= pr.savings.toFixed(2) %></span>
                  <% } %>
                </div>

                <!-- Stock -->
                <div class="item-meta mt-2">
                  <% if (p.stock > 0) { %>
                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                    <span class="font-medium" style="color: var(--success);">In Stock</span>
                  <% } else { %>
                    <i class="fas fa-times-circle" style="color: var(--danger);"></i>
                    <span class="font-medium" style="color: var(--danger);">Out of Stock</span>
                  <% } %>
                </div>
              </div>

              <!-- Actions -->
              <div class="flex flex-col gap-2 ml-4">
                <% if (p.stock > 0) { %>
                  <button 
                    class="add-to-cart-btn bg-[#0a2a2d] text-white text-xs font-semibold px-4 py-2 rounded hover:bg-[#0f3a3f] transition whitespace-nowrap"
                    data-product-id="<%= p._id %>">
                    Add to Cart
                  </button>
                <% } else { %>
                  <button class="btn-out-of-stock" disabled>Out of Stock</button>
                <% } %>

                <button 
                  class="remove-wishlist-btn text-red-600 hover:text-red-800 text-xs flex items-center gap-1"
                  data-product-id="<%= p._id %>">
                  <i class="fas fa-trash-alt"></i> Remove
                </button>
              </div>
            </div>
          <% }) %>
        </div>

        <!-- Action Buttons -->
        <div id="action-buttons" class="action-buttons" style="display: <%= wishlist.length > 0 ? 'flex' : 'none' %>;">
          <button id="add-all-to-cart" class="add-all-btn">
            <i class="fas fa-shopping-cart"></i> Add All Available to Cart
          </button>
          <button id="clear-wishlist" class="clear-btn">
            <i class="fas fa-trash"></i> Clear Wishlist
          </button>
        </div>

        <!-- Info Box -->
        <div class="row mt-5">
          <div class="col-md-12">
            <div class="p-3 bg-light rounded shadow-sm">
              <h6>How Wishlist Works</h6>
              <ul class="small text-muted mb-0">
                <li>Save products you love for later</li>
                <li>Get notified when items go on sale</li>
                <li>Add to cart anytime with one click</li>
                <li>Items stay until you remove them</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="partial">
    <%- include("../../views/partials/user/footer") %>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

 <script defer src="/js/user/wishList.js"></script>
</body>
</html>